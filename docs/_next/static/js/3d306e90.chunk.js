"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{9825:function(e,t,n){var i=n(8596);function r(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(t){a(t)}}function s(e){try{c(i.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))}"function"===typeof SuppressedError&&SuppressedError;var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},o={exports:{}};!function(e){var t,n;t=a,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},a=null;function o(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var a=i[r];this[a]=r<n?e:this.methodFactory(a,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function u(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,a){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}(i)||u.apply(this,arguments)}function l(e,n){var o,s,u,l=this,h="loglevel";function f(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(a){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(a){}return void 0===l.levels[e]&&(e=void 0),e}}function p(e){var t=e;if("string"===typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),"number"===typeof t&&t>=0&&t<=l.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"===typeof e?h+=":"+e:"symbol"===typeof e&&(h=void 0),l.name=e,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=n||d,l.getLevel=function(){return null!=u?u:null!=s?s:o},l.setLevel=function(e,n){return u=p(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(r){}}}(u),c.call(l)},l.setDefaultLevel=function(e){s=p(e),f()||l.setLevel(e,!1)},l.resetLevel=function(){u=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(l)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)},l.rebuild=function(){if(a!==l&&(o=p(a.getLevel())),c.call(l),a===l)for(var e in r)r[e].rebuild()},o=p(a?a.getLevel():"WARN");var y=f();null!=y&&(u=p(y)),c.call(l)}(a=new l).getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new l(e,a.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=h),a},a.getLoggers=function(){return r},a.default=a,a},e.exports?e.exports=n():t.log=n()}(o);var s,c,u=o.exports;!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(s||(s={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(c||(c={}));let d=u.getLogger("livekit");function l(e){const t=u.getLogger(e);return t.setDefaultLevel(d.getLevel()),t}Object.values(c).map((e=>u.getLogger(e))),d.setDefaultLevel(s.info);const h=u.getLogger("lk-e2ee");function f(e,t){if(!e)throw new Error(t)}const p=34028234663852886e22,y=-34028234663852886e22,m=4294967295,g=2147483647,b=-2147483648;function v(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>g||e<b)throw new Error("invalid int 32: "+e)}function k(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>m||e<0)throw new Error("invalid uint 32: "+e)}function w(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>p||e<y))throw new Error("invalid float 32: "+e)}const S=Symbol("@bufbuild/protobuf/enum-type");function T(e){const t=e[S];return f(t,"missing enum type on enum object"),t}function I(e,t,n,i){e[S]=E(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function E(e,t,n){const i=Object.create(null),r=Object.create(null),a=[];for(const o of t){const e=C(o);a.push(e),i[o.name]=e,r[o.no]=e}return{typeName:e,values:a,findName:e=>i[e],findNumber:e=>r[e]}}function N(e,t,n){const i={};for(const r of t){const e=C(r);i[e.localName]=e.no,i[e.no]=e.localName}return I(i,e,t),i}function C(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class A{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function L(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function O(e,t,n){for(let a=0;a<28;a+=7){const i=e>>>a,r=!(i>>>7==0&&0==t),o=255&(r?128|i:i);if(n.push(o),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),a=255&(r?128|i:i);if(n.push(a),!r)return}n.push(t>>>31&1)}}const U=4294967296;function F(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function a(t,a){const o=Number(e.slice(t,a));r*=n,i=i*n+o,i>=U&&(r+=i/U|0,i%=U)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?P(i,r):R(i,r)}function D(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(U*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,a=n+8147497*i,o=2*i;const s=1e7;return r>=s&&(a+=Math.floor(r/s),r%=s),a>=s&&(o+=Math.floor(a/s),a%=s),o.toString()+x(a)+x(r)}function R(e,t){return{lo:0|e,hi:0|t}}function P(e,t){return t=~t,e?e=1+~e:t+=1,R(e,t)}const x=e=>{const t=String(e);return"0000000".slice(t.length)+t};function B(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function _(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const M=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof i||"object"!=typeof i.env||"1"!==i.env.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>f(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>f(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),F(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),F(e)),dec:(e,t)=>function(e,t){let n=R(e,t);const i=2147483648&n.hi;i&&(n=P(n.lo,n.hi));const r=D(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>D(e,t)}}();var K,V,j;function G(e,t,n){if(t===n)return!0;if(e==K.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return t==n}return!1}function J(e,t){switch(e){case K.BOOL:return!1;case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return 0==t?M.zero:"0";case K.DOUBLE:case K.FLOAT:return 0;case K.BYTES:return new Uint8Array(0);case K.STRING:return"";default:return 0}}function q(e,t){switch(e){case K.BOOL:return!1===t;case K.STRING:return""===t;case K.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(K||(K={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(V||(V={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(j||(j={}));class X{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(k(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return v(e),B(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){w(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){k(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){v(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return v(e),B(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=M.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=M.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=M.enc(e);return O(t.lo,t.hi,this.buf),this}sint64(e){let t=M.enc(e),n=t.hi>>31;return O(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=M.uEnc(e);return O(t.lo,t.hi,this.buf),this}}class W{constructor(e,t){this.varint64=L,this.uint32=_,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case j.Varint:for(;128&this.buf[this.pos++];);break;case j.Bit64:this.pos+=4;case j.Bit32:this.pos+=4;break;case j.LengthDelimited:let n=this.uint32();this.pos+=n;break;case j.StartGroup:for(;;){const[e,n]=this.tag();if(n===j.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return M.dec(...this.varint64())}uint64(){return M.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,M.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return M.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return M.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function H(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return J(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),z=[];for(let gn=0;gn<Y.length;gn++)z[Y[gn].charCodeAt(0)]=gn;z["-".charCodeAt(0)]=Y.indexOf("+"),z["_".charCodeAt(0)]=Y.indexOf("/");const Q={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,a=0,o=0;for(let s=0;s<e.length;s++){if(n=z[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:o=n,a=1;break;case 1:i[r++]=o<<2|(48&n)>>4,o=n,a=2;break;case 2:i[r++]=(15&o)<<4|(60&n)>>2,o=n,a=3;break;case 3:i[r++]=(3&o)<<6|n,a=0}}if(1==a)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let a=0;a<e.length;a++)switch(t=e[a],i){case 0:n+=Y[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=Y[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=Y[r|t>>6],n+=Y[63&t],i=0}return i&&(n+=Y[r],n+="=",1==i&&(n+="=")),n}};function $(e,t,n){te(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}(e.getType().runtime.bin.listUnknownFields(e),t.field),[a,o]=H(t);for(const s of r)t.runtime.bin.readField(a,i.readerFactory(s.data),t.field,s.wireType,i);return o()}function Z(e,t,n,i){te(t,e);const r=t.runtime.bin.makeReadOptions(i),a=t.runtime.bin.makeWriteOptions(i);if(ee(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const o=a.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,o,a);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function ee(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function te(e,t){f(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function ne(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!q(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function ie(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?J(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function re(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(A.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function ae(e,t){return re(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}K.DOUBLE,K.FLOAT,K.INT64,K.UINT64,K.INT32,K.UINT32,K.BOOL,K.STRING,K.BYTES;const oe={ignoreUnknownFields:!1},se={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function ce(e){return e?Object.assign(Object.assign({},oe),e):oe}function ue(e){return e?Object.assign(Object.assign({},se),e):se}const de=Symbol(),le=Symbol();function he(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function fe(e,t,n,i,r){let a=n.localName;if(n.repeated){if(f("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(t)));const s=e[a];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,i));break;case"enum":const t=me(n.T,e,i.ignoreUnknownFields,!0);t!==le&&s.push(t);break;case"scalar":try{s.push(ye(n.T,e,n.L,!0))}catch(o){let t="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(e));throw o instanceof Error&&o.message.length>0&&(t+=": ".concat(o.message)),new Error(t)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(t)));const s=e[a];for(const[e,a]of Object.entries(t)){if(null===a)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=pe(n.K,e)}catch(o){let e="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(t));throw o instanceof Error&&o.message.length>0&&(e+=": ".concat(o.message)),new Error(e)}switch(n.V.kind){case"message":s[c]=n.V.T.fromJson(a,i);break;case"enum":const e=me(n.V.T,a,i.ignoreUnknownFields,!0);e!==le&&(s[c]=e);break;case"scalar":try{s[c]=ye(n.V.T,a,V.BIGINT,!0)}catch(o){let e="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(t));throw o instanceof Error&&o.message.length>0&&(e+=": ".concat(o.message)),new Error(e)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:a},a="value"),n.kind){case"message":const s=n.T;if(null===t&&"google.protobuf.Value"!=s.typeName)return;let c=e[a];re(c)?c.fromJson(t,i):(e[a]=c=s.fromJson(t,i),s.fieldWrapper&&!n.oneof&&(e[a]=s.fieldWrapper.unwrapField(c)));break;case"enum":const u=me(n.T,t,i.ignoreUnknownFields,!1);switch(u){case de:ie(n,e);break;case le:break;default:e[a]=u}break;case"scalar":try{const i=ye(n.T,t,n.L,!1);if(i===de)ie(n,e);else e[a]=i}catch(o){let e="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(he(t));throw o instanceof Error&&o.message.length>0&&(e+=": ".concat(o.message)),new Error(e)}}}function pe(e,t){if(e===K.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return ye(e,t,V.BIGINT,!0).toString()}function ye(e,t,n,i){if(null===t)return i?J(e,n):de;switch(e){case K.DOUBLE:case K.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==K.FLOAT&&w(i),i;case K.INT32:case K.FIXED32:case K.SFIXED32:case K.SINT32:case K.UINT32:let a;if("number"==typeof t?a=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(a=Number(t)),void 0===a)break;return e==K.UINT32||e==K.FIXED32?k(a):v(a),a;case K.INT64:case K.SFIXED64:case K.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=M.parse(t);return n?o.toString():o;case K.FIXED64:case K.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const s=M.uParse(t);return n?s.toString():s;case K.BOOL:if("boolean"!==typeof t)break;return t;case K.STRING:if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(r){throw new Error("invalid UTF8")}return t;case K.BYTES:if(""===t)return new Uint8Array(0);if("string"!==typeof t)break;return Q.dec(t)}throw new Error}function me(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:de;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return le}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(he(t)))}function ge(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function be(e,t,n){if("map"==e.kind){f("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,a]of r)i[n.toString()]=ke(e.V.T,a);break;case"message":for(const[e,a]of r)i[e.toString()]=a.toJson(n);break;case"enum":const t=e.V.T;for(const[e,a]of r)i[e.toString()]=ve(t,a,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){f(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(ke(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(ve(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return ke(e.T,t);case"enum":return ve(e.T,t,n.enumAsInteger);case"message":return ae(e.T,t).toJson(n)}}function ve(e,t,n){var i;if(f("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null===r||void 0===r?void 0:r.name)&&void 0!==i?i:t}function ke(e,t){switch(e){case K.INT32:case K.SFIXED32:case K.SINT32:case K.FIXED32:case K.UINT32:return f("number"==typeof t),t;case K.FLOAT:case K.DOUBLE:return f("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case K.STRING:return f("string"==typeof t),t;case K.BOOL:return f("boolean"==typeof t),t;case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return f("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case K.BYTES:return f(t instanceof Uint8Array),Q.enc(t)}}const we=Symbol("@bufbuild/protobuf/unknown-fields"),Se={readUnknownFields:!0,readerFactory:e=>new W(e)},Te={writeUnknownFields:!0,writerFactory:()=>new X};function Ie(e){return e?Object.assign(Object.assign({},Se),e):Se}function Ee(e){return e?Object.assign(Object.assign({},Te),e):Te}function Ne(e,t,n,i,r){let{repeated:a,localName:o}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=o&&delete e.value,e.case=o,o="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?K.INT32:n.T;let c=Le;if("scalar"==n.kind&&n.L>0&&(c=Ae),a){let n=e[o];if(i==j.LengthDelimited&&s!=K.STRING&&s!=K.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[o]=c(t,s);break;case"message":const u=n.T;a?e[o].push(Ce(t,new u,r,n)):re(e[o])?Ce(t,e[o],r,n):(e[o]=Ce(t,new u,r,n),!u.fieldWrapper||n.oneof||n.repeated||(e[o]=u.fieldWrapper.unwrapField(e[o])));break;case"map":let[d,l]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let a,o;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:a=Le(t,e.K);break;case 2:switch(e.V.kind){case"scalar":o=Le(t,e.V.T);break;case"enum":o=t.int32();break;case"message":o=Ce(t,new e.V.T,n,void 0)}}}void 0===a&&(a=J(e.K,V.BIGINT));"string"!=typeof a&&"number"!=typeof a&&(a=a.toString());if(void 0===o)switch(e.V.kind){case"scalar":o=J(e.V.T,V.BIGINT);break;case"enum":o=e.V.T.values[0].no;break;case"message":o=new e.V.T}return[a,o]}(n,t,r);e[o][d]=l}}function Ce(e,t,n,i){const r=t.getType().runtime.bin,a=null===i||void 0===i?void 0:i.delimited;return r.readMessage(t,e,a?i.no:e.uint32(),n,a),t}function Ae(e,t){const n=Le(e,t);return"bigint"==typeof n?n.toString():n}function Le(e,t){switch(t){case K.STRING:return e.string();case K.BOOL:return e.bool();case K.DOUBLE:return e.double();case K.FLOAT:return e.float();case K.INT32:return e.int32();case K.INT64:return e.int64();case K.UINT64:return e.uint64();case K.FIXED64:return e.fixed64();case K.BYTES:return e.bytes();case K.FIXED32:return e.fixed32();case K.SFIXED32:return e.sfixed32();case K.SFIXED64:return e.sfixed64();case K.SINT64:return e.sint64();case K.UINT32:return e.uint32();case K.SINT32:return e.sint32()}}function Oe(e,t,n,i){f(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let a="enum"==e.kind?K.INT32:e.T;if(r)if(f(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,j.LengthDelimited).fork();let[,r]=Re(t);for(let a=0;a<i.length;a++)e[r](i[a]);e.join()}(n,a,e.no,t);else for(const i of t)De(n,a,e.no,i);else De(n,a,e.no,t);break;case"message":if(r){f(Array.isArray(t));for(const r of t)Fe(n,i,e,r)}else Fe(n,i,e,t);break;case"map":f("object"==typeof t&&null!=t);for(const[r,o]of Object.entries(t))Ue(n,i,e,r,o)}}function Ue(e,t,n,i,r){e.tag(n.no,j.LengthDelimited),e.fork();let a=i;switch(n.K){case K.INT32:case K.FIXED32:case K.UINT32:case K.SFIXED32:case K.SINT32:a=Number.parseInt(i);break;case K.BOOL:f("true"==i||"false"==i),a="true"==i}switch(De(e,n.K,1,a),n.V.kind){case"scalar":De(e,n.V.T,2,r);break;case"enum":De(e,K.INT32,2,r);break;case"message":f(void 0!==r),e.tag(2,j.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Fe(e,t,n,i){const r=ae(n.T,i);n.delimited?e.tag(n.no,j.StartGroup).raw(r.toBinary(t)).tag(n.no,j.EndGroup):e.tag(n.no,j.LengthDelimited).bytes(r.toBinary(t))}function De(e,t,n,i){f(void 0!==i);let[r,a]=Re(t);e.tag(n,r)[a](i)}function Re(e){let t=j.Varint;switch(e){case K.BYTES:case K.STRING:t=j.LengthDelimited;break;case K.DOUBLE:case K.FIXED64:case K.SFIXED64:t=j.Bit64;break;case K.FIXED32:case K.SFIXED32:case K.FLOAT:t=j.Bit32}return[t,K[e].toLowerCase()]}function Pe(e){if(void 0===e)return e;if(re(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function xe(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class Be{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function _e(e,t){const n=Ke(e);return t?n:qe(Je(n))}const Me=Ke;function Ke(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Ve=new Set(["constructor","toString","toJSON","valueOf"]),je=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Ge=e=>"".concat(e,"$"),Je=e=>je.has(e)?Ge(e):e,qe=e=>Ve.has(e)?Ge(e):e;class Xe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=_e(e,!1)}addField(e){f(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const We=(He=e=>new Be(e,(e=>function(e,t){var n,i,r,a,o,s;const c=[];let u;for(const d of"function"==typeof e?e():e){const e=d;if(e.localName=_e(d.name,void 0!==d.oneof),e.jsonName=null!==(n=d.jsonName)&&void 0!==n?n:Me(d.name),e.repeated=null!==(i=d.repeated)&&void 0!==i&&i,"scalar"==d.kind&&(e.L=null!==(r=d.L)&&void 0!==r?r:V.BIGINT),e.delimited=null!==(a=d.delimited)&&void 0!==a&&a,e.req=null!==(o=d.req)&&void 0!==o&&o,e.opt=null!==(s=d.opt)&&void 0!==s&&s,void 0===d.packed&&(e.packed="enum"==d.kind||"scalar"==d.kind&&d.T!=K.BYTES&&d.T!=K.STRING),void 0!==d.oneof){const t="string"==typeof d.oneof?d.oneof:d.oneof.name;u&&u.name==t||(u=new Xe(t)),e.oneof=u,u.addField(e)}c.push(e)}return c}(e))),Ye=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=J(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:ce,makeWriteOptions:ue,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(he(t)));i=null!==i&&void 0!==i?i:new e;const r=new Map,a=n.typeRegistry;for(const[o,s]of Object.entries(t)){const t=e.fields.findJsonName(o);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(o,'"'));r.set(t.oneof,o)}fe(i,s,t,n,e)}else{let t=!1;if((null===a||void 0===a?void 0:a.findExtension)&&o.startsWith("[")&&o.endsWith("]")){const r=a.findExtension(o.substring(1,o.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,a]=H(r);fe(e,s,r.field,n,r),Z(i,r,a(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!ne(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!ge(r))continue}const n=be(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const a=t.typeRegistry;if(null===a||void 0===a?void 0:a.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const o=a.findExtensionFor(n.typeName,r.no);if(o&&ee(e,o)){const n=$(e,o,t),r=be(o.field,n,t);void 0!==r&&(i[o.field.jsonName]=r)}}}catch(a){const e=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),t=a instanceof Error?a.message:String(a);throw new Error(e+(t.length>0?": ".concat(t):""))}return i},readScalar:(e,t,n)=>ye(e,t,null!==n&&void 0!==n?n:V.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||q(e,t)?ke(e,t):void 0},debug:he},bin:{makeReadOptions:Ie,makeWriteOptions:Ee,listUnknownFields(e){var t;return null!==(t=e[we])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[we]},writeUnknownFields(e,t){const n=e[we];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[we])||(r[we]=[]),r[we].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const a=e.getType(),o=r?t.len:t.pos+n;let s,c;for(;t.pos<o&&([s,c]=t.tag(),!0!==r||c!=j.EndGroup);){const n=a.fields.find(s);if(n)Ne(e,t,n,c,i);else{const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n)}}if(r&&(c!=j.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:Ne,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(ne(r,e))Oe(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Oe(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:I,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,a=e;if(null!=a[n])switch(i.kind){case"oneof":const e=a[n].case;if(void 0===e)continue;const t=i.findField(e);let o=a[n].value;t&&"message"==t.kind&&!re(o,t.T)?o=new t.T(o):t&&"scalar"===t.kind&&t.T===K.BYTES&&(o=xe(o)),r[n]={case:e,value:o};break;case"scalar":case"enum":let s=a[n];i.T===K.BYTES&&(s=i.repeated?s.map(xe):xe(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===K.BYTES)for(const[t,i]of Object.entries(a[n]))r[n][t]=xe(i);else Object.assign(r[n],a[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(a[n])){let i=a[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=a[n].map((e=>re(e,c)?e:new c(e)));else{const e=a[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=xe(e):r[n]=e:r[n]=re(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>G(e.T,t,r[n])));case"enum":return i.every(((e,t)=>G(K.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(i,r);case"enum":return G(K.INT32,i,r);case"scalar":return G(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const t=e.findField(i.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(i.value,r.value);case"enum":return G(K.INT32,i.value,r.value);case"scalar":return G(t.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(i[e],r[e])));case"enum":return n.every((e=>G(K.INT32,i[e],r[e])));case"scalar":const a=e.V.T;return n.every((e=>G(a,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(Pe);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=Pe(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:Pe(t.value)}:{case:void 0}:Pe(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:He,initFields:Ye}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const a=null!==(r=null===i||void 0===i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),o={[a]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[a];return Object.setPrototypeOf(o.prototype,new A),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new o).fromBinary(e,t),fromJson:(e,t)=>(new o).fromJson(e,t),fromJsonString:(e,t)=>(new o).fromJsonString(e,t),equals:(t,n)=>e.util.equals(o,t,n)}),o}(this,e,t,n)},makeEnum:N,makeEnumType:E,getEnumType:T,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var He,Ye;const ze=We.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Qe=We.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),$e=We.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Ze=/version\/(\d+(\.?_?\d+)+)/i;let et;function tt(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof navigator)return;const n=navigator.userAgent.toLowerCase();if(void 0===et||t){const e=nt.find((e=>{let{test:t}=e;return t.test(n)}));et=null===e||void 0===e?void 0:e.describe(n)}return et}const nt=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:it(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:rt(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:it(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:rt(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:it(Ze,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:rt(e)})}];function it(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function rt(e){return e.includes("mac os")?it(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class at{constructor(e,t,n,i,r){if("object"===typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}var ot;!function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:2e4},e.music={maxBitrate:32e3},e.musicStereo={maxBitrate:48e3},e.musicHighQuality={maxBitrate:64e3},e.musicHighQualityStereo={maxBitrate:96e3}}(ot||(ot={})),new at(160,90,9e4,20),new at(320,180,16e4,20),new at(384,216,18e4,20),new at(640,360,45e4,20),new at(960,540,8e5,25),new at(1280,720,17e5,30),new at(1920,1080,3e6,30),new at(2560,1440,5e6,30),new at(3840,2160,8e6,30),new at(160,120,7e4,20),new at(240,180,125e3,20),new at(320,240,14e4,20),new at(480,360,33e4,20),new at(640,480,5e5,20),new at(720,540,6e5,25),new at(960,720,13e5,30),new at(1440,1080,23e5,30),new at(1920,1440,38e5,30),new at(640,360,2e5,3,"medium"),new at(640,360,4e5,15,"medium"),new at(1280,720,8e5,5,"medium"),new at(1280,720,15e5,15,"medium"),new at(1280,720,2e6,30,"medium"),new at(1920,1080,25e5,15,"medium"),new at(1920,1080,5e6,30,"medium"),new at(0,0,7e6,30,"medium");var st,ct={exports:{}},ut="object"===typeof Reflect?Reflect:null,dt=ut&&"function"===typeof ut.apply?ut.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};st=ut&&"function"===typeof ut.ownKeys?ut.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var lt=Number.isNaN||function(e){return e!==e};function ht(){ht.init.call(this)}ct.exports=ht,ct.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}St(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&St(e,"error",t,n)}(e,r,{once:!0})}))},ht.EventEmitter=ht,ht.prototype._events=void 0,ht.prototype._eventsCount=0,ht.prototype._maxListeners=void 0;var ft=10;function pt(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function yt(e){return void 0===e._maxListeners?ht.defaultMaxListeners:e._maxListeners}function mt(e,t,n,i){var r,a,o,s;if(pt(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"===typeof o?o=a[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=yt(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function gt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bt(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=gt.bind(i);return r.listener=n,i.wrapFn=r,r}function vt(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):wt(r,r.length)}function kt(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function wt(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function St(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(a){i.once&&e.removeEventListener(t,r),n(a)}))}}Object.defineProperty(ht,"defaultMaxListeners",{enumerable:!0,get:function(){return ft},set:function(e){if("number"!==typeof e||e<0||lt(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ft=e}}),ht.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ht.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||lt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ht.prototype.getMaxListeners=function(){return yt(this)},ht.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=r[e];if(void 0===s)return!1;if("function"===typeof s)dt(s,this,t);else{var c=s.length,u=wt(s,c);for(n=0;n<c;++n)dt(u[n],this,t)}return!0},ht.prototype.addListener=function(e,t){return mt(this,e,t,!1)},ht.prototype.on=ht.prototype.addListener,ht.prototype.prependListener=function(e,t){return mt(this,e,t,!0)},ht.prototype.once=function(e,t){return pt(t),this.on(e,bt(this,e,t)),this},ht.prototype.prependOnceListener=function(e,t){return pt(t),this.prependListener(e,bt(this,e,t)),this},ht.prototype.removeListener=function(e,t){var n,i,r,a,o;if(pt(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},ht.prototype.off=ht.prototype.removeListener,ht.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},ht.prototype.listeners=function(e){return vt(this,e,!0)},ht.prototype.rawListeners=function(e){return vt(this,e,!1)},ht.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):kt.call(e,t)},ht.prototype.listenerCount=kt,ht.prototype.eventNames=function(){return this._eventsCount>0?st(this._events):[]};var Tt,It,Et,Nt,Ct=ct.exports;!function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed"}(Tt||(Tt={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage"}(It||(It={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse"}(Et||(Et={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate"}(Nt||(Nt={}));const At=[];var Lt,Ot;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(Lt||(Lt={}));class Ut extends Ct.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Ut.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=d,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=l(null!==(i=n.loggerName)&&void 0!==i?i:c.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Ut.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Dt(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Ut.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===Ut.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(At.forEach((t=>{null!==t.parentElement||e||(e=t)})),e&&At.splice(At.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),function(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream;i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks();i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e));Rt()&&t instanceof HTMLVideoElement||(t.autoplay=!0);t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0);t.srcObject!==n&&(t.srcObject=n,(Rt()||function(){var e;return"Firefox"===(null===(e=tt())||void 0===e?void 0:e.name)}())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some((e=>"audio"===e.kind));return e.play().then((()=>{this.emit(i?Nt.AudioPlaybackStarted:Nt.VideoPlaybackStarted)})).catch((t=>{"NotAllowedError"===t.name?this.emit(i?Nt.AudioPlaybackFailed:Nt.VideoPlaybackFailed,t):"AbortError"===t.name?d.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):d.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some((e=>"video"===e.kind))&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch((()=>{})))})),this.emit(Nt.ElementAttached,e),e}detach(e){try{if(e){Ft(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Nt.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach((e=>{Ft(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Nt.ElementDetached,e)})),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=l(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),At.forEach((e=>{e.parentElement||(t=!1)})),t&&At.push(e)}}handleAppVisibilityChanged(){return r(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==Ut.Kind.Video||setTimeout((()=>this.attachedElements.forEach((e=>e.play().catch((()=>{}))))),0)}))}addAppVisibilityListener(){Pt()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Pt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ft(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function Dt(e){return e instanceof Ut?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?Dt(e.track):{})}}function Rt(){var e;return"Safari"===(null===(e=tt())||void 0===e?void 0:e.name)}function Pt(){return"undefined"!==typeof document}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return ze.AUDIO;case t.Video:return ze.VIDEO;default:return ze.DATA}},e.kindFromProto=function(e){switch(e){case ze.AUDIO:return t.Audio;case ze.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return Qe.CAMERA;case n.Microphone:return Qe.MICROPHONE;case n.ScreenShare:return Qe.SCREEN_SHARE;case n.ScreenShareAudio:return Qe.SCREEN_SHARE_AUDIO;default:return Qe.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Qe.CAMERA:return n.Camera;case Qe.MICROPHONE:return n.Microphone;case Qe.SCREEN_SHARE:return n.ScreenShare;case Qe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case $e.ACTIVE:return i.Active;case $e.PAUSED:return i.Paused;default:return i.Unknown}}}(Ut||(Ut={}));class xt{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}}!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Ot||(Ot={}));const Bt="AES-GCM",_t={key:10,delta:3,audio:1,empty:0},Mt={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:10,keyringSize:16};class Kt extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}var Vt,jt,Gt,Jt,qt,Xt;!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(Vt||(Vt={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(Vt||(Vt={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(jt||(jt={}));class Wt extends Kt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jt.InternalError,n=arguments.length>2?arguments[2]:void 0;super(40,e),this.reason=t,this.participantIdentity=n}}function Ht(e,t){const n=(new TextEncoder).encode(t);switch(e){case"HKDF":return{name:"HKDF",salt:n,hash:"SHA-256",info:new ArrayBuffer(128)};case"PBKDF2":return{name:"PBKDF2",salt:n,hash:"SHA-256",iterations:1e5};default:throw new Error("algorithm ".concat(e," is currently unsupported"))}}function Yt(e,t){return r(this,void 0,void 0,(function*(){const n=Ht(e.algorithm.name,t),i=yield crypto.subtle.deriveKey(n,e,{name:Bt,length:128},!1,["encrypt","decrypt"]);return{material:e,encryptionKey:i}}))}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(Gt||(Gt={})),function(e){e.KeyRatcheted="keyRatcheted"}(Jt||(Jt={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(qt||(qt={})),function(e){e.Error="cryptorError"}(Xt||(Xt={}));class zt{constructor(){this.consecutiveSifCount=0,this.lastSifReceivedAt=0,this.userFramesSinceSif=0}recordSif(){var e;this.consecutiveSifCount+=1,null!==(e=this.sifSequenceStartedAt)&&void 0!==e||(this.sifSequenceStartedAt=Date.now()),this.lastSifReceivedAt=Date.now()}recordUserFrame(){void 0!==this.sifSequenceStartedAt&&(this.userFramesSinceSif+=1,(this.userFramesSinceSif>this.consecutiveSifCount||Date.now()-this.lastSifReceivedAt>2e3)&&this.reset())}isSifAllowed(){return this.consecutiveSifCount<100&&(void 0===this.sifSequenceStartedAt||Date.now()-this.sifSequenceStartedAt<2e3)}reset(){this.userFramesSinceSif=0,this.consecutiveSifCount=0,this.sifSequenceStartedAt=void 0}}const Qt=new Map;class $t extends Ct.EventEmitter{encodeFunction(e,t){throw Error("not implemented for subclass")}decodeFunction(e,t){throw Error("not implemented for subclass")}}class Zt extends $t{constructor(e){var t;super(),this.sendCounts=new Map,this.keys=e.keys,this.participantIdentity=e.participantIdentity,this.rtpMap=new Map,this.keyProviderOptions=e.keyProviderOptions,this.sifTrailer=null!==(t=e.sifTrailer)&&void 0!==t?t:Uint8Array.from([]),this.sifGuard=new zt}get logContext(){return{participant:this.participantIdentity,mediaTrackId:this.trackId,fallbackCodec:this.videoCodec}}setParticipant(e,t){h.debug("setting new participant on cryptor",Object.assign(Object.assign({},this.logContext),{participant:e})),this.participantIdentity&&h.error("cryptor has already a participant set, participant should have been unset before",Object.assign({},this.logContext)),this.participantIdentity=e,this.keys=t,this.sifGuard.reset()}unsetParticipant(){h.debug("unsetting participant",this.logContext),this.participantIdentity=void 0}isEnabled(){return this.participantIdentity?Qt.get(this.participantIdentity):void 0}getParticipantIdentity(){return this.participantIdentity}getTrackId(){return this.trackId}setVideoCodec(e){this.videoCodec=e}setRtpMap(e){this.rtpMap=e}setupTransform(e,t,n,i,r){r&&(h.info("setting codec on cryptor to",{codec:r}),this.videoCodec=r),h.debug("Setting up frame cryptor transform",Object.assign({operation:e,passedTrackId:i,codec:r},this.logContext));const a="encode"===e?this.encodeFunction:this.decodeFunction,o=new TransformStream({transform:a.bind(this)});t.pipeThrough(o).pipeTo(n).catch((e=>{h.warn(e),this.emit(Xt.Error,e instanceof Wt?e:new Wt(e.message,void 0,this.participantIdentity))})),this.trackId=i}setSifTrailer(e){h.debug("setting SIF trailer",Object.assign(Object.assign({},this.logContext),{trailer:e})),this.sifTrailer=e}encodeFunction(e,t){return r(this,void 0,void 0,(function*(){var n;if(!this.isEnabled()||0===e.data.byteLength)return t.enqueue(e);const i=this.keys.getKeySet();if(!i)return void this.emit(Xt.Error,new Wt("key set not found for ".concat(this.participantIdentity," at index ").concat(this.keys.getCurrentKeyIndex()),jt.MissingKey,this.participantIdentity));const{encryptionKey:r}=i,a=this.keys.getCurrentKeyIndex();if(r){const i=this.makeIV(null!==(n=e.getMetadata().synchronizationSource)&&void 0!==n?n:-1,e.timestamp);let c=this.getUnencryptedBytes(e);const u=new Uint8Array(e.data,0,c.unencryptedBytes),d=new Uint8Array(2);d[0]=12,d[1]=a;try{const n=yield crypto.subtle.encrypt({name:Bt,iv:i,additionalData:new Uint8Array(e.data,0,u.byteLength)},r,new Uint8Array(e.data,c.unencryptedBytes));let a=new Uint8Array(n.byteLength+i.byteLength+d.byteLength);a.set(new Uint8Array(n)),a.set(new Uint8Array(i),n.byteLength),a.set(d,n.byteLength+i.byteLength),c.isH264&&(a=function(e){const t=[];for(var n=0,i=0;i<e.length;++i){var r=e[i];r<=3&&n>=2&&(t.push(3),n=0),t.push(r),0==r?++n:n=0}return new Uint8Array(t)}(a));var o=new Uint8Array(u.byteLength+a.byteLength);return o.set(u),o.set(a,u.byteLength),e.data=o.buffer,t.enqueue(e)}catch(s){h.error(s)}}else h.debug("failed to encrypt, emitting error",this.logContext),this.emit(Xt.Error,new Wt("encryption key missing for encoding",jt.MissingKey,this.participantIdentity))}))}decodeFunction(e,t){return r(this,void 0,void 0,(function*(){if(!this.isEnabled()||0===e.data.byteLength)return h.debug("skipping empty frame",this.logContext),this.sifGuard.recordUserFrame(),t.enqueue(e);if(function(e,t){if(0===t.byteLength)return!1;const n=new Uint8Array(e.slice(e.byteLength-t.byteLength));return t.every(((e,t)=>e===n[t]))}(e.data,this.sifTrailer))return h.debug("enqueue SIF",this.logContext),this.sifGuard.recordSif(),this.sifGuard.isSifAllowed()?(e.data=e.data.slice(0,e.data.byteLength-this.sifTrailer.byteLength),t.enqueue(e)):void h.warn("SIF limit reached, dropping frame");this.sifGuard.recordUserFrame();const n=new Uint8Array(e.data)[e.data.byteLength-1];if(this.keys.getKeySet(n)&&this.keys.hasValidKey)try{const i=yield this.decryptFrame(e,n);if(this.keys.decryptionSuccess(),i)return t.enqueue(i)}catch(i){i instanceof Wt&&i.reason===jt.InvalidKey?this.keys.hasValidKey&&(this.emit(Xt.Error,i),this.keys.decryptionFailure()):h.warn("decoding frame failed",{error:i})}else!this.keys.getKeySet(n)&&this.keys.hasValidKey&&(h.warn("skipping decryption due to missing key at index ".concat(n)),this.emit(Xt.Error,new Wt("missing key at index ".concat(n," for participant ").concat(this.participantIdentity),jt.MissingKey,this.participantIdentity)),this.keys.decryptionFailure())}))}decryptFrame(e,t){return r(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{ratchetCount:0};return function*(){var a;const o=n.keys.getKeySet(t);if(!r.encryptionKey&&!o)throw new TypeError("no encryption key found for decryption of ".concat(n.participantIdentity));let s=n.getUnencryptedBytes(e);try{const t=new Uint8Array(e.data,0,s.unencryptedBytes);var c=new Uint8Array(e.data,t.length,e.data.byteLength-t.length);if(s.isH264&&function(e){for(var t=0;t<e.length-3;t++)if(0==e[t]&&0==e[t+1]&&3==e[t+2])return!0;return!1}(c)){c=function(e){const t=[];for(var n=e.length,i=0;i<e.length;)n-i>=3&&!e[i]&&!e[i+1]&&3==e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);return new Uint8Array(t)}(c);const n=new Uint8Array(t.byteLength+c.byteLength);n.set(t),n.set(c,t.byteLength),e.data=n.buffer}const n=new Uint8Array(e.data,e.data.byteLength-2,2),i=n[0],u=new Uint8Array(e.data,e.data.byteLength-i-n.byteLength,i),d=t.byteLength,l=e.data.byteLength-(t.byteLength+i+n.byteLength),h=yield crypto.subtle.decrypt({name:Bt,iv:u,additionalData:new Uint8Array(e.data,0,t.byteLength)},null!==(a=r.encryptionKey)&&void 0!==a?a:o.encryptionKey,new Uint8Array(e.data,d,l)),f=new ArrayBuffer(t.byteLength+h.byteLength),p=new Uint8Array(f);return p.set(new Uint8Array(e.data,0,t.byteLength)),p.set(new Uint8Array(h),t.byteLength),e.data=f,e}catch(u){if(n.keyProviderOptions.ratchetWindowSize>0){if(r.ratchetCount<n.keyProviderOptions.ratchetWindowSize){let a;if(h.debug("ratcheting key attempt ".concat(r.ratchetCount," of ").concat(n.keyProviderOptions.ratchetWindowSize,", for kind ").concat(e instanceof RTCEncodedAudioFrame?"audio":"video")),(null!==i&&void 0!==i?i:o)===n.keys.getKeySet(t)){const e=yield n.keys.ratchetKey(t,!1);a=yield Yt(e,n.keyProviderOptions.ratchetSalt)}const s=yield n.decryptFrame(e,t,i||o,{ratchetCount:r.ratchetCount+1,encryptionKey:null===a||void 0===a?void 0:a.encryptionKey});return s&&a&&(null!==i&&void 0!==i?i:o)===n.keys.getKeySet(t)&&(n.keys.setKeySet(a,t,!0),n.keys.setCurrentKeyIndex(t)),s}throw h.warn("maximum ratchet attempts exceeded"),new Wt("valid key missing for participant ".concat(n.participantIdentity),jt.InvalidKey,n.participantIdentity)}throw new Wt("Decryption failed: ".concat(u.message),jt.InvalidKey,n.participantIdentity)}}()}))}makeIV(e,t){var n;const i=new ArrayBuffer(12),r=new DataView(i);this.sendCounts.has(e)||this.sendCounts.set(e,Math.floor(65535*Math.random()));const a=null!==(n=this.sendCounts.get(e))&&void 0!==n?n:0;return r.setUint32(0,e),r.setUint32(4,t),r.setUint32(8,t-a%65535),this.sendCounts.set(e,a+1),i}getUnencryptedBytes(e){var t,n={unencryptedBytes:0,isH264:!1};if(function(e){return"type"in e}(e)){let r=null!==(t=this.getVideoCodec(e))&&void 0!==t?t:this.videoCodec;if(r!==this.detectedCodec&&(h.debug("detected different codec",Object.assign({detectedCodec:r,oldCodec:this.detectedCodec},this.logContext)),this.detectedCodec=r),"av1"===r)throw new Error("".concat(r," is not yet supported for end to end encryption"));if("vp8"===r)n.unencryptedBytes=_t[e.type];else if("vp9"===r)return n.unencryptedBytes=0,n;const a=new Uint8Array(e.data);try{const e=function(e){const t=[];let n=0,i=0,r=e.length-2;for(;i<r;){for(;i<r&&(0!==e[i]||0!==e[i+1]||1!==e[i+2]);)i++;i>=r&&(i=e.length);let a=i;for(;a>n&&0===e[a-1];)a--;if(0===n){if(a!==n)throw TypeError("byte stream contains leading data")}else t.push(n);n=i+=3}return t}(a);if(n.isH264="h264"===r||e.some((e=>[nn.SLICE_IDR,nn.SLICE_NON_IDR].includes(en(a[e])))),n.isH264){for(const t of e){switch(en(a[t])){case nn.SLICE_IDR:case nn.SLICE_NON_IDR:return n.unencryptedBytes=t+2,n}}throw new TypeError("Could not find NALU")}}catch(i){}return n.unencryptedBytes=_t[e.type],n}return n.unencryptedBytes=_t.audio,n}getVideoCodec(e){if(0===this.rtpMap.size)return;const t=e.getMetadata().payloadType;return t?this.rtpMap.get(t):void 0}}function en(e){return e&tn}const tn=31;var nn;!function(e){e[e.SLICE_NON_IDR=1]="SLICE_NON_IDR",e[e.SLICE_PARTITION_A=2]="SLICE_PARTITION_A",e[e.SLICE_PARTITION_B=3]="SLICE_PARTITION_B",e[e.SLICE_PARTITION_C=4]="SLICE_PARTITION_C",e[e.SLICE_IDR=5]="SLICE_IDR",e[e.SEI=6]="SEI",e[e.SPS=7]="SPS",e[e.PPS=8]="PPS",e[e.AUD=9]="AUD",e[e.END_SEQ=10]="END_SEQ",e[e.END_STREAM=11]="END_STREAM",e[e.FILLER_DATA=12]="FILLER_DATA",e[e.SPS_EXT=13]="SPS_EXT",e[e.PREFIX_NALU=14]="PREFIX_NALU",e[e.SUBSET_SPS=15]="SUBSET_SPS",e[e.DPS=16]="DPS",e[e.SLICE_AUX=19]="SLICE_AUX",e[e.SLICE_EXT=20]="SLICE_EXT",e[e.SLICE_LAYER_EXT=21]="SLICE_LAYER_EXT"}(nn||(nn={}));class rn extends Ct.EventEmitter{get hasValidKey(){return this._hasValidKey}constructor(e,t){if(super(),this.decryptionFailureCount=0,this._hasValidKey=!0,this.currentKeyIndex=0,t.keyringSize<1||t.keyringSize>255)throw new TypeError("Keyring size needs to be between 1 and 256");this.cryptoKeyRing=new Array(t.keyringSize).fill(void 0),this.keyProviderOptions=t,this.ratchetPromiseMap=new Map,this.participantIdentity=e,this.resetKeyStatus()}decryptionFailure(){this.keyProviderOptions.failureTolerance<0||(this.decryptionFailureCount+=1,this.decryptionFailureCount>this.keyProviderOptions.failureTolerance&&(h.warn("key for ".concat(this.participantIdentity," is being marked as invalid")),this._hasValidKey=!1))}decryptionSuccess(){this.resetKeyStatus()}resetKeyStatus(){this.decryptionFailureCount=0,this._hasValidKey=!0}ratchetKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=null!==e&&void 0!==e?e:this.getCurrentKeyIndex(),i=this.ratchetPromiseMap.get(n);if("undefined"!==typeof i)return i;const a=new Promise(((e,i)=>r(this,void 0,void 0,(function*(){try{const i=this.getKeySet(n);if(!i)throw new TypeError("Cannot ratchet key without a valid keyset of participant ".concat(this.participantIdentity));const a=i.material,o=yield function(e){return r(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:Bt},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"encrypt";return function*(){return crypto.subtle.importKey("raw",e,t,!1,"derive"===n?["deriveBits","deriveKey"]:["encrypt","decrypt"])}()}))}(yield function(e,t){return r(this,void 0,void 0,(function*(){const n=Ht(e.algorithm.name,t);return crypto.subtle.deriveBits(n,e,256)}))}(a,this.keyProviderOptions.ratchetSalt),a.algorithm.name,"derive");t&&(this.setKeyFromMaterial(o,n,!0),this.emit(Jt.KeyRatcheted,o,this.participantIdentity,n)),e(o)}catch(a){i(a)}finally{this.ratchetPromiseMap.delete(n)}}))));return this.ratchetPromiseMap.set(n,a),a}setKey(e){return r(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function*(){yield t.setKeyFromMaterial(e,n),t.resetKeyStatus()}()}))}setKeyFromMaterial(e,t){return r(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){const r=yield Yt(e,n.keyProviderOptions.ratchetSalt),a=t>=0?t%n.cryptoKeyRing.length:n.currentKeyIndex;h.debug("setting new key with index ".concat(t),{usage:e.usages,algorithm:e.algorithm,ratchetSalt:n.keyProviderOptions.ratchetSalt}),n.setKeySet(r,a,i),a>=0&&(n.currentKeyIndex=a)}()}))}setKeySet(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.cryptoKeyRing[t%this.cryptoKeyRing.length]=e,n&&this.emit(Jt.KeyRatcheted,e.material,this.participantIdentity,t)}setCurrentKeyIndex(e){return r(this,void 0,void 0,(function*(){this.currentKeyIndex=e%this.cryptoKeyRing.length,this.resetKeyStatus()}))}getCurrentKeyIndex(){return this.currentKeyIndex}getKeySet(e){return this.cryptoKeyRing[null!==e&&void 0!==e?e:this.currentKeyIndex]}}const an=[],on=new Map;let sn,cn,un=new class{constructor(){this.pendingTasks=new Map,this.taskMutex=new xt,this.nextTaskIndex=0}run(e){return r(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ot.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Ot.RUNNING,yield e()}finally{t.status=Ot.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return r(this,void 0,void 0,(function*(){return this.run((()=>r(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}},dn=!1,ln=Mt,hn=new Map;function fn(e,t){let n=an.filter((e=>e.getTrackId()===t));if(n.length>1){const i=n.map((e=>({participant:e.getParticipantIdentity()}))).join(",");h.error("Found multiple cryptors for the same trackID ".concat(t,". target participant: ").concat(e," "),{participants:i})}let i=n[0];if(i)e!==i.getParticipantIdentity()&&i.setParticipant(e,pn(e));else{if(h.info("creating new cryptor for",{participantIdentity:e}),!ln)throw Error("Missing keyProvider options");i=new Zt({participantIdentity:e,keys:pn(e),keyProviderOptions:ln,sifTrailer:cn}),i.setRtpMap(hn),function(e){e.on(Xt.Error,(e=>{const t={kind:"error",data:{error:new Error("".concat(jt[e.reason],": ").concat(e.message))}};postMessage(t)}))}(i),an.push(i)}return i}function pn(e){if(dn)return yn();let t=on.get(e);return t||(t=new rn(e,ln),t.on(Jt.KeyRatcheted,mn),on.set(e,t)),t}function yn(){return sn||(h.debug("creating new shared key handler"),sn=new rn("shared-key",ln)),sn}function mn(e,t,n){postMessage({kind:"ratchetKey",data:{participantIdentity:t,keyIndex:n,material:e}})}h.setDefaultLevel("info"),onmessage=e=>{un.run((()=>r(void 0,void 0,void 0,(function*(){const{kind:t,data:n}=e.data;switch(t){case"init":h.setLevel(n.loglevel),h.info("worker initialized"),ln=n.keyProviderOptions,dn=!!n.keyProviderOptions.sharedKey;postMessage({kind:"initAck",data:{enabled:false}});break;case"enable":a=n.enabled,o=n.participantIdentity,h.debug("setting encryption enabled for all tracks of ".concat(o),{enable:a}),Qt.set(o,a),h.info("updated e2ee enabled status for ".concat(n.participantIdentity," to ").concat(n.enabled)),postMessage(e.data);break;case"decode":fn(n.participantIdentity,n.trackId).setupTransform(t,n.readableStream,n.writableStream,n.trackId,n.codec);break;case"encode":fn(n.participantIdentity,n.trackId).setupTransform(t,n.readableStream,n.writableStream,n.trackId,n.codec);break;case"setKey":dn?yield function(e,t){return r(this,void 0,void 0,(function*(){h.info("set shared key",{index:t}),yield yn().setKey(e,t)}))}(n.key,n.keyIndex):n.participantIdentity?(h.info("set participant sender key ".concat(n.participantIdentity," index ").concat(n.keyIndex)),yield pn(n.participantIdentity).setKey(n.key,n.keyIndex)):h.error("no participant Id was provided and shared key usage is disabled");break;case"removeTransform":!function(e,t){const n=an.filter((n=>n.getParticipantIdentity()===t&&n.getTrackId()===e));n.length>1&&h.error("Found multiple cryptors for the same participant and trackID combination",{trackId:e,participantIdentity:t});const i=n[0];i?i.unsetParticipant():h.warn("Could not unset participant on cryptor",{trackId:e,participantIdentity:t})}(n.trackId,n.participantIdentity);break;case"updateCodec":fn(n.participantIdentity,n.trackId).setVideoCodec(n.codec);break;case"setRTPMap":hn=n.map,an.forEach((e=>{e.getParticipantIdentity()===n.participantIdentity&&e.setRtpMap(n.map)}));break;case"ratchetRequest":!function(e){r(this,void 0,void 0,(function*(){if(dn){const t=yn();yield t.ratchetKey(e.keyIndex),t.resetKeyStatus()}else if(e.participantIdentity){const t=pn(e.participantIdentity);yield t.ratchetKey(e.keyIndex),t.resetKeyStatus()}else h.error("no participant Id was provided for ratchet request and shared key usage is disabled")}))}(n);break;case"setSifTrailer":i=n.trailer,cn=i,an.forEach((e=>{e.setSifTrailer(i)}))}var i,a,o}))))},self.RTCTransformEvent&&(h.debug("setup transform event"),self.onrtctransform=e=>{const t=e.transformer;h.debug("transformer",t),t.handled=!0;const{kind:n,participantIdentity:i,trackId:r,codec:a}=t.options,o=fn(i,r);h.debug("transform",{codec:a}),o.setupTransform(n,t.readable,t.writable,r,a)})}}]);
//# sourceMappingURL=3d306e90.chunk.js.map